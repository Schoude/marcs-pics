# App design for marcs-pics.tk

## App MVP

### Interactions with the app
1) Only one user is the admin and can create and edit shared collections.
2) Shared collections can only be viewed when visiting from a deeplink like `https://marcs-pics.tk/collection/693202b5-fd2a-457e-993e-8308b838d88e`
3) The creator of a shared collection can sort the photos, give them a description and tags. The global tags from the photo box to which the image is related to get copied over to each image. More individual tags can be added for each image.
4) Known tags from the photo box of other images should be shown as suggestions for better UX.
5) Shared collections can be password protected.
6) Visitors of the shared collection can leave a comment as a guest user.

#### Future features
1) Add a location marker with a map.
2) Shared collections with photos from multiple photo boxes.
3) PWA with persistant storage of the shared collection. Let's the user view already downloaded images offline (i am guessing here that this could work).

### Retrieving a shared collection via deeplink

There are two scenarios a user can face:
1) The shared collection is __not__ password protected
or
2) it __is__ password protected.

In either cass the app makes an API call to the server and gets the shared collection related to the hash. If the collection is **not** password protected (i.e. the password field is not there), the response contains the full collection.

If the found collection is password protected the API endpoint returns a 401 with a special response body or cookie. This tells the app to show the password input view. After the user inputs a password the same endpoint gets called with the password as the request body, then validated agains the password of the shared collection (401 if invalid) or 200 with the full collection as the response.

Also set a cookie that the user entered the password correctly and can enter
the site without having to enter the password again. Lifetime should be one week or so.

<hr>

## Data models and MongoDB collections
I try to use as little cross collection lookups as possible and save the data together in the Document.

### Document schemas
0) `users` <br> For now there is only one user and admin (me).
```jsonc
// struct User
{
  "_id": ObjectId('9a895880-c891-426f-80dc-ed0094a1a455'),
  "nickname": "Schoude",
  "email": "marcbaque1311@gmail.com",

  // brypted or hased with more secure Argon2 algorithm
  "pasword": "$2a$12$FCnvM1w4RjpL3X2ztKqA8ORAQdwnKDjZ7W5.BPxVO31SJtdFoR2Ri",

  // enum UserRole
  "role": "Admin"
}
```

1) `photo_boxes`
```jsonc
// struct PhotoBox
{
  "_id": ObjectId('3032ef76-ac01-4730-b540-a705a2139d18'),
  "owner_id": ObjectId('9a895880-c891-426f-80dc-ed0094a1a455'),

  // both firesbase fields are needed to get the files references fot the photobox
  "firebase_root_folder_name": "marcs-pics",
  "firebase_folder_name": "usa2022",
  "display_name": "USA Reise 2022",
  "description": "The photos of my trip to the USA!",

  // can be empty but not missing
  "tags": [
    "USA",
    "groundhopping",
    "2022"
  ],

  // plain urls of all the images of the photo_box - the ordering is arbitrary.
  "photo_urls": [
    "https://marcs-pics-usa2022.firebase.com/image1",
    "https://marcs-pics-usa2022.firebase.com/image2",
    "https://marcs-pics-usa2022.firebase.com/image3",
    "https://marcs-pics-usa2022.firebase.com/image4",
    "https://marcs-pics-usa2022.firebase.com/image4",
  ],

  // set in JS or get it from the "_id" ObjectId instance if availablei
  "created_at": UTC-Date
}
```

2) `shared_collections`
```jsonc
// struct SharedCollection
{
  "_id": ObjectId('e7b2645d-e2fc-49e8-af32-800fa05a831f'),

  // password field is optional
  "password": "$bryptedpw",
  "photo_box_id": ObjectId('3032ef76-ac01-4730-b540-a705a2139d18'),

  // create a search index for the "hash" field in the database.
  "hash": "da1j4djAbi1k4498iYk8",
  "description": "The photos of my trip to the USA!",

  // struct CollectionImage -> embedded documents
  "images": [{
    // the id can be an object id but not generated by mongodb itself but via the `ObjectId` struct.
    // the CollectionImages are just embedded docs and don't have an seperate collection
    "_id": ObjectId('4bdd44ad-051c-4205-9aa6-d31890b29d3e'),
    "url": "https://marcs-pics-usa2022.firebase.com/image1",
    "description": "This is a cool photo of me in NY!",

    // copy the tags of the original photo_box
    "tags": [
      "USA",
      "groundhopping",
      "2022",
      // own tags of the photo below
      "New York",
      "Statue of Liberty"
    ],
    // the order comes from the array ordering, which is the order in the HTML node list
    "order": 0,

    // for now NO user accounts are planned to be added.
    // all comments are made by guests who have to give at least a name.
    // struct CollectionImageComment
    "comments": [{
      "_id": ObjectId('e0972587-5d56-4dab-a4a9-419e2222c3ec'),
      "creator_name": "Rainer",
      "creator_email": "drachenlord1488@gmx.com",
      "text": "Foll geile foddos etzadla heddich mal gsacht.",
      "created_at": UTC-Data
    }],

    // set in JS or get it from the "_id" ObjectId instance if availablei
    "created_at": UTC-Date
  }]
}
```
