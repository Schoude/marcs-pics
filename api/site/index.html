<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="/style.css">
  <style>
    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 1.5rem;
    }

    .boxes-container a {
      display: block;
      margin-block-end: 1.5rem;
    }

  </style>
  <title>Übersicht - Marc's Pics</title>
</head>

<body>
  <header>
    <nav>
      <button type="button">Ausloggen</button>
    </nav>
  </header>
  <h1>Übersicht</h1>

  <main>
    <section class="boxes-container">
      <h2>Deine Fotoboxen</h2>
      <a href="/new-photo-box">Neue Fotobox erstellen</a>
      <div class="boxes"></div>
    </section>
    <section class="collections-container">
      <h2>Deine Kollektionen</h2>
      <div class="collections">
        <p>Du hast noch keine Kollektionen erstellt..!</p>
      </div>
    </section>
  </main>
</body>

<script type="module">
  import { checkAuth, logoutUser } from '/js/auth.js';
  import { getAllPhotoBoxes } from '/js/photo-box.js';
  await checkAuth();

  const btnLogout = document.querySelector('button');
  const boxesEl = document.querySelector('.boxes');
  const collectionsEl = document.querySelector('.collections');

  async function onLogout() {
    await logoutUser();
  }

  async function fetchPhotoBoxes() {
    const boxes = await getAllPhotoBoxes();

    boxes.forEach(box => {
      const boxEl = document.createElement('article');
      boxEl.classList.add('photo-box');
      const name = document.createElement('h3');
      const desc = document.createElement('p');
      const editLinkEl = document.createElement('a');
      name.innerText = box.display_name;
      desc.innerText = box.description;
      editLinkEl.innerText = 'Fotobox bearbeiten';
      editLinkEl.href = `/edit-photo-box?id=${box._id.$oid}`;

      // tags
      const tagEls = box.tags.map(tag => {
        const tagEl = document.createElement('li');
        tagEl.classList.add('tag');
        tagEl.innerText = tag;

        return tagEl;
      });
      const tagsContainerEl = document.createElement('ul');
      tagsContainerEl.classList.add('tags-container');
      tagEls.forEach(tagEl => tagsContainerEl.appendChild(tagEl));

      // link to create new collection from this photo box.
      const linkEl = document.createElement('a');
      linkEl.href = `/new-collection?folder=${box.folder_name}`;
      linkEl.innerText = 'Neue Kollektion aus dieser Fotobox erstellen';

      boxEl.appendChild(name);
      boxEl.appendChild(desc);
      boxEl.appendChild(editLinkEl);
      boxEl.appendChild(tagsContainerEl);
      boxEl.appendChild(linkEl);

      boxesEl.appendChild(boxEl);
    });
  }

  btnLogout.addEventListener('click', onLogout);

  fetchPhotoBoxes();
</script>

</html>
