<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="/style.css">
  <title>Übersicht - Marc's Pics</title>
</head>

<body>
  <header>
    <nav>
      <a href="/new-photo-box">Neue Fotobox erstellen</a>
      <button type="button">Ausloggen</button>
    </nav>
  </header>
  <h1>Übersicht</h1>

  <section class="boxes">
    <h2>Deine Fotoboxen</h2>
  </section>

  <section class="collections">
    <h2>Deine Kollektionen</h2>
  </section>
</body>

<script type="module">
  const btnLogout = document.querySelector('button');
  const res = await fetch('/api/me');
  const boxesEl = document.querySelector('.boxes');
  const collectionsEl = document.querySelector('.collections');

  if (res.status === 401) {
    window.location.pathname = '/login';
  }

  async function onLogout() {
    const res = await fetch('/api/logout', { method: 'POST' });

    if (res.status === 202) {
      window.location.pathname = '/login';
    }
  }

  async function fetchPhotoBoxes() {
    const boxes = await (await fetch('/api/photo-boxes')).json();
    boxes.forEach(box => {
      const boxEl = document.createElement('article');
      const name = document.createElement('h3');
      const desc = document.createElement('p');
      name.innerText = box.display_name;
      desc.innerText = box.description;

      // tags
      const tagEls = box.tags.map(tag => {
        const tagEl = document.createElement('li');
        tagEl.classList.add('tag');
        tagEl.innerText = tag;

        return tagEl;
      });
      const tagsContainerEl = document.createElement('ul');
      tagEls.forEach(tagEl => tagsContainerEl.appendChild(tagEl));

      // link to create new collection from this photo box.
      const linkEl = document.createElement('a');
      linkEl.href = `/new-collection?root=${box.firebase_root_folder_name}&folder=${box.firebase_folder_name}`;
      linkEl.innerText = 'Neue Kollektion aus dieser Fotobox erstellen';

      boxEl.appendChild(name);
      boxEl.appendChild(desc);
      boxesEl.appendChild(boxEl);
      boxesEl.appendChild(tagsContainerEl);
      boxesEl.appendChild(linkEl);
    });
  }

  btnLogout.addEventListener('click', onLogout);

  fetchPhotoBoxes();
</script>

</html>
